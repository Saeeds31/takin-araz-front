<template>
    <nav class="w-[90vw] mx-auto" v-if="salePlan">
        <ul class="flex items-center gap3">
            <li class="flex items-center gap-2">
                <router-link to="/">
                    ุตูุญู ุงุตู
                </router-link>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                    role="img" class="iconify iconify--bxi bxi text-neutral-40 dark:text-neutral-60" width="1"
                    height="1" viewBox="0 0 24 24" style="font-size: 1rem; width: 1rem; height: 1rem;">
                    <path d="M15.71,7.41l-4.59,4.59,4.59,4.59-1.41,1.41-6-6,6-6,1.41,1.41Z" fill="currentColor">
                    </path>
                </svg>
            </li>
            <li class="flex items-center gap-2">
                <router-link to="#">
                    ุทุฑุญ ูุง ูุฑูุด
                </router-link>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                    role="img" class="iconify iconify--bxi bxi text-neutral-40 dark:text-neutral-60" width="1"
                    height="1" viewBox="0 0 24 24" style="font-size: 1rem; width: 1rem; height: 1rem;">
                    <path d="M15.71,7.41l-4.59,4.59,4.59,4.59-1.41,1.41-6-6,6-6,1.41,1.41Z" fill="currentColor">
                    </path>
                </svg>
            </li>

            <li class="flex items-center gap-2">
                <router-link class="flex items-center gap-1" to="#">

                    <span class="font-bold">
                        {{ salePlan?.title }}
                    </span>
                </router-link>
            </li>

        </ul>
    </nav>
    <section v-if="salePlan" class="mt-12 mb-12 flex flex-col items-center gap-2">
        <h2 class=" text-2xl font-bold">
            {{ salePlan.title }}
        </h2>
        <p class="flex items-center gap-1.5">
            <span>
                ุฒูุงู ุซุจุช ูุงู:
            </span>
            <span>ุงุฒ ุชุงุฑุฎ</span>
            <span class="font-bold">
                {{ new Date(salePlan.start_date).toLocaleDateString("fa") }}
            </span>
            <span>ุชุง ุชุงุฑุฎ:</span>
            <span class="font-bold">
                {{ new Date(salePlan.end_date).toLocaleDateString("fa") }}
            </span>
        </p>
    </section>
    <main class="grid md:grid-cols-3 lg:grid-cols-4 grid-cols-2 gap-4 items-start w-screen px-[5%] mt-8"
        v-if="salePlan">
        <carCard @handlerCar="handlerId" v-for="(item, index) in salePlan.cars" :key="index" :car="item"
            :salemode="true" />
    </main>
    <div v-else class="flex items-center justify-center mt-[86px]">
        <div class="loader">
            <div class="loader_cube loader_cube--color"></div>
            <div class="loader_cube loader_cube--glowing"></div>
        </div>
    </div>
    <!--  -->
    <section v-show="salePlan && selectId" id="selectSale">
        <div class="h-[40vh] overflow-y-scroll w-[90%] mx-auto mt-8 mb-4 px-12 py-12">
            <h3 class="font-bold">
                ๐ ููุงูู ู ููุฑุฑุงุช ุจุฑุง ุซุจุชโูุงู ู ูพุดโุฎุฑุฏ ุฎูุฏุฑู ุฎุงุฑุฌ

            </h3>
            <ul class="flex flex-col gap-4 items-start mt-16">
                <li>
                    1. ุดุฑุงุท ุนููู
                    ุซุจุชโูุงู ุตุฑูุงู ุจุฑุง ุงูุฑุงุฏ ุจุงูุง ฑธ ุณุงู ุงูฺฉุงูโูพุฐุฑ ุงุณุช.

                    ฺฉุงุฑุจุฑ ููุธู ุงุณุช ุงุทูุงุนุงุช ุดุฎุต ู ููุช ุฎูุฏ ุฑุง ุจูโุตูุฑุช ุตุญุญ ู ฺฉุงูู ูุงุฑุฏ ฺฉูุฏ.

                    ูุฑฺฏููู ุซุจุชโูุงู ุจุง ุงุทูุงุนุงุช ุฌุนู ุง ูุงูุต ููุฌุจ ูุบู ูุฑุงุฑุฏุงุฏ ุฎูุงูุฏ ุดุฏ.

                </li>
                <li>
                    2. ุดุฑุงุท ูุงู
                    ูุจูุบ ูพุดโูพุฑุฏุงุฎุช (ุจุนุงูู) ุบุฑูุงุจูโุงุณุชุฑุฏุงุฏ ุงุณุช ูฺฏุฑ ุฏุฑ ุดุฑุงุท ุฎุงุต ฺฉู ุดุฑฺฉุช ุงุนูุงู ฺฉูุฏ.

                    ูพุฑุฏุงุฎุชโูุง ุจุงุฏ ุตุฑูุงู ุงุฒ ุทุฑู ุฏุฑฺฏุงูโูุง ุฑุณู ุณุงุช ุงูุฌุงู ุดูุฏ.

                    ููุช ููุง ุฎูุฏุฑู ููฺฉู ุงุณุช ุจุง ุชูุฌู ุจู ูุฑุฎ ุงุฑุฒุ ุชุนุฑููโูุง ฺฏูุฑฺฉ ู ูุฒููโูุง ุญููโูููู ุชุบุฑ ฺฉูุฏ.

                </li>
                <li>

                    3. ุดุฑุงุท ุชุญูู
                    ุฒูุงู ุชุญูู ุฎูุฏุฑู ุชูุฑุจ ุจูุฏู ู ุจู ุดุฑุงุท ูุงุฑุฏุงุชุ ุชุฑุฎุต ู ููุงูู ฺฏูุฑฺฉ ูุงุจุณุชู ุงุณุช.

                    ุดุฑฺฉุช ูุชุนูุฏ ุงุณุช ุฏุฑ ุตูุฑุช ุชุฃุฎุฑ ุจุด ุงุฒ ูุฏุช ูุดุฎุต (ูุซูุงู ถ ูุงู)ุ ุงูฺฉุงู ุงูุตุฑุงู ู ุจุงุฒฺฏุดุช ูุฌู ุฑุง ูุฑุงูู ฺฉูุฏ.

                    ุฎูุฏุฑููุง ูุทุงุจู ุจุง ุงุณุชุงูุฏุงุฑุฏูุง ูุงุฑุฏุงุช ฺฉุดูุฑ ุชุญูู ุฏุงุฏู ุฎูุงููุฏ ุดุฏ.

                </li>
                <li>
                    4. ุญููู ู ุชุนูุฏุงุช ูุดุชุฑ
                    ูุดุชุฑ ููุธู ุงุณุช ูพุณ ุงุฒ ุงุนูุงู ุดุฑฺฉุชุ ูุฏุงุฑฺฉ ูุงุฒู ุจุฑุง ุชุฑุฎุต ู ุดูุงุฑูโฺฏุฐุงุฑ ุฑุง ุงุฑุงุฆู ุฏูุฏ.

                    ูุดุชุฑ ุญู ุงูุชูุงู ูุฑุงุฑุฏุงุฏ ุจู ุดุฎุต ุซุงูุซ ุฑุง ุจุฏูู ุงุทูุงุน ู ุชุฃุฏ ุดุฑฺฉุช ูุฏุงุฑุฏ.

                    ูุดุชุฑ ููุธู ุงุณุช ููุงูู ุฑุงูููุง ู ุฑุงููุฏฺฏ ู ููุฑุฑุงุช ูุฑุจูุท ุจู ุฎูุฏุฑููุง ูุงุฑุฏุงุช ุฑุง ุฑุนุงุช ฺฉูุฏ.

                </li>
                <li>

                    5. ุญููู ู ุชุนูุฏุงุช ุดุฑฺฉุช
                    ุดุฑฺฉุช ููุธู ุงุณุช ุงุทูุงุนุงุช ุดูุงู ุฏุฑ ููุฑุฏ ุฎูุฏุฑูุ ููุชุ ุดุฑุงุท ุชุญูู ู ุฎุฏูุงุช ูพุณ ุงุฒ ูุฑูุด ุงุฑุงุฆู ุฏูุฏ.

                    ุดุฑฺฉุช ุญู ุฏุงุฑุฏ ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉูุงุช ูุงููู ุง ฺฏูุฑฺฉุ ูุฑุงุฑุฏุงุฏ ุฑุง ุจุง ุจุงุฒฺฏุฑุฏุงูุฏู ูุฌู ูุณุฎ ฺฉูุฏ.

                    ุดุฑฺฉุช ูุณุฆููุช ุฏุฑ ูุจุงู ุชุบุฑุงุช ููุงูู ูุงุฑุฏุงุช ู ุชุนุฑููโูุง ุฏููุช ูุฏุงุฑุฏ.

                </li>
                <li>
                    6. ูุณุฎ ูุฑุงุฑุฏุงุฏ
                    ุฏุฑ ุตูุฑุช ุนุฏู ูพุฑุฏุงุฎุช ุงูุณุงุท ุง ูุฏุงุฑฺฉ ูุงูุตุ ุดุฑฺฉุช ุญู ูุณุฎ ูุฑุงุฑุฏุงุฏ ุฑุง ุฏุงุฑุฏ.

                    ูุดุชุฑ ุฏุฑ ุตูุฑุช ุชุบุฑ ุดุฑุงุท ุบุฑูุงุจู ูพุดโุจู (ูุงููุฏ ููููุนุช ูุงุฑุฏุงุช) ุญู ูุณุฎ ูุฑุงุฑุฏุงุฏ ู ุฏุฑุงูุช ูุฌู ุฑุง
                    ุฎูุงูุฏ ุฏุงุดุช.


                </li>
                <li>

                    7. ูพุฐุฑุด ููุงูู
                    ุซุจุชโูุงู ุฏุฑ ุณุงุช ุจู ููุฒูู ูพุฐุฑุด ฺฉุงูู ุงู ููุงูู ู ููุฑุฑุงุช ุงุณุช.

                    ฺฉุงุฑุจุฑ ููุธู ุงุณุช ูุจู ุงุฒ ุชุฃุฏ ููุงุ ุชูุงู ุจูุฏูุง ุงู ููุงูู ุฑุง ูุทุงูุนู ฺฉูุฏ.

                </li>
            </ul>
        </div>
        <div class="w-full">

            <BaseButton @click="register()" :disabled="loader" class="w-[310px] mx-auto mt-8 mb-8 base-back">
                ุชุงุฏ ููุงูู ู ูพุด ุซุจุช ูุงู
            </BaseButton>
        </div>
    </section>
</template>

<script setup>
import carCard from '@/components/shared/carCard.vue';
import { Swiper, SwiperSlide } from "swiper/vue";
import { EffectCoverflow, Pagination } from "swiper/modules";
import { computed, onMounted, ref, watch } from "vue"
import "swiper/css";
import "swiper/css/effect-coverflow";
import BaseButton from '@/common/UI/BaseButton.vue';
import "swiper/css/pagination";
import { useSalePlan } from '@/stores/modules/salePlan';
import { useRoute } from "vue-router";
import router from "@/router";
import { getCurrentInstance } from 'vue'
import { useProfile } from '@/stores/modules/profile';
import { toast } from "vue3-toastify";
const instance = getCurrentInstance()
const $axios = instance.appContext.config.globalProperties.$axios;
const store = useSalePlan();
const store1 = useProfile();
const route = useRoute();
let selectId = ref(null);
const user = computed(() => store1.user);
function handlerId(id) {
    if (!id) return;
    selectId.value = id;
    setTimeout(() => {
        document.getElementById('selectSale').scrollIntoView({ behavior: 'smooth' })
    }, 500)
}
async function register() {
    if (!user.value) {
        window.localStorage.setItem('lastpage', route.fullPath);
        return toast.error('ุจุฑุง ูพุด ุซุจุช ูุงู ูุทูุง ุงุจุชุฏุง ูุงุฑุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฎูุฏ ุดูุฏ')
    }
    try {
        loader.value = true;
        const fd = new FormData();
        fd.append('car_id', selectId.value)
        let res = await $axios.post(`/car-request/${route.params.id}`, fd);
        if (res.data.success) {
            toast.success(res.data.message);
            setTimeout(() => {
                router.push('/')
            }, 5000);
        }
    } catch (error) {
        toast.error(error?.response.data.message)
    } finally {
        loader.value = false;
    }
}
onMounted(() => {
    if (route.query.car_id) {
        handlerId(route.query.car_id)
    }
});
const salePlan = computed(() => store.salePlan);
watch(() => salePlan.value, () => {
    handlerId(route.query.car_id)

})
const modules = [EffectCoverflow, Pagination];
const coverflowConfig = {
    rotate: 0,
    stretch: 0,
    depth: 200,
    modifier: 1.1,
    slideShadows: false,
};
let loader = ref(false);
store.getSaleDetailFromServer(route.params.id);
async function gotoLink(id) {
    loader.value = true;
    try {
        let res = await $axios.get(`/check-sale/${id}`);
        if (res.data.salePlan) {
            router.push(`/sales-plan/${res.data.salePlan}?car_id=${id}`);
        } else {
        }
    } catch (error) {
        console.log(error);

    } finally {
        loader.value = false
    }
    // 
}

</script>
<style>
/* From Uiverse.io by mobinkakei */
.loader {
    width: 150px;
    height: 150px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.loader_cube {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 30px;
}

.loader_cube--glowing {
    z-index: 2;
    background-color: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.loader_cube--color {
    z-index: 1;
    filter: blur(2px);
    background: linear-gradient(135deg, #1afbf0, #da00ff);
    animation: loadtwo 2.5s ease-in-out infinite;
}

@keyframes loadtwo {
    50% {
        transform: rotate(-80deg);
    }
}

.custom-swiper :deep(.swiper-slide) {
    display: flex;
    justify-content: center;
    align-items: center;
    transform: scale(0.75);
    transition: transform 0.4s ease, opacity 0.4s ease;
}

/* ูุณุท ุจุฒุฑฺฏโุชุฑ */
.custom-swiper :deep(.swiper-slide-active) {
    transform: scale(1.15);
    z-index: 3;
}

/* ฺฉูุงุฑโูุง ฺฉู ุจุฒุฑฺฏโุชุฑ ุงุฒ ุจูู ูู ูุญูโุชุฑ */
.custom-swiper :deep(.swiper-slide-next),
.custom-swiper :deep(.swiper-slide-prev) {
    transform: scale(0.5);
}

/* smooth ุญุฑฺฉุช ูุฑู */
.custom-swiper :deep(.swiper-wrapper) {
    transition-timing-function: cubic-bezier(0.22, 0.9, 0.32, 1);
}

/* ุนฺฉุณ ูุญุตูู */
.product-image {
    height: 380px;
    object-fit: contain;
}

/* pagination */
.custom-swiper :deep(.swiper-pagination-bullet) {
    background-color: var(--bg-secondary-fade);
    opacity: 0.6;
    transition: all 0.25s ease;
    margin-top: 20px;
}

.custom-swiper :deep(.swiper-pagination-bullet-active) {
    background-color: var(--bg-secondary);
    opacity: 1;
    transform: scale(1.4);
}

/* ุฑุณูพุงูุณู */
@media (max-width: 575px) {
    .custom-swiper :deep(.swiper-slide) {
        transform: scale(1);
        opacity: 1;
    }

    .product-image {
        height: 180px;
    }
}

@media (min-width: 576px) and (max-width: 767px) {
    .custom-swiper {
        padding: 0 40px;
    }

    .custom-swiper :deep(.swiper-slide) {
        transform: scale(0.9);
    }

    .custom-swiper :deep(.swiper-slide-active) {
        transform: scale(1.05);
    }
}
</style>